<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>FlexiGrid</title>
<%
   out.println("tableId:"+request.getParameter("tableId"));
%>
<link href="/nmdss/sang/css/flexigrid.css" type="text/css" rel="stylesheet" />
<link href="/nmdss/sang/css/contextmenu.css" type="text/css" rel="stylesheet"  />
<script src="/nmdss/sang/js/jquery-1.4.2.js" type="text/javascript"></script>
<script src="/nmdss/sang/js/jquery.contextmenu.js" type="text/javascript"></script>
<script src="/nmdss/sang/js/jquery.flexigrid.js" type="text/javascript" ></script>
<script type="text/javascript">
	$(document)
			.ready(function() {
				//alert('dddddddddddd');
				var maiheight = document.documentElement.clientHeight;
				var w = $("#ptable").width() - 3;
				var gapTop = 30;
				var otherpm = 150; //GridHead，toolbar，footer,gridmargin
					var h = maiheight - gapTop - otherpm;


				var qsql = $("#queryFormSql").val();
				//alert(qsql);
					//alert('dddddddddddd');
					
					var grid = $("#flex1")
							.flexigrid(
									{
										width : w,
										height: h,
										url : '/nmdss/queryController?action=list',
										dataType : 'json',
										colModel : [ {
											display : '编号',
											name : 'id',
											width : 50,
											sortable : true,
											align : 'center',
											toggle : false
										}, {
											display : 'table id',
											name : 'table_id',
											width : 250,
											sortable : true,
											align : 'center'
										}, {
											display : '描述',
											name : 'workSpaceDesc',
											width : 120,
											sortable : true,
											align : 'right'
										}, {
											display : '创建人',
											name : 'creator',
											width : 60,
											sortable : true,
											align : 'center'
										}, {
											display : '创建日期',
											name : 'createdDate',
											width : 80,
											sortable : true,
											align : 'center'
										} ],
										
										searchitems : [ {
											display : '编号',
											name : 'id',
											isdefault : true
										}, {
											display : '工作名称',
											name : 'job_name'
										}, {
											display : '工作地址',
											name : 'work_address'
										}, {
											display : '语言',
											name : 'language'
										} ],
										errormsg : '发生异常',
										sortname : "id",
										querySql : $("#queryFormSql").val(),
										sortorder : "desc",
										//qop: "LIKE",//搜索的操作符
										usepager : true,
										title : '测试信息明细',
										pagestat : '显示记录从{from}到{to}，总数 {total} 条',
										useRp : true,
										rp : 10,
										rpOptions : [ 10, 15, 20, 30, 40, 100 ], //可选择设定的每页结果数
										nomsg : '没有符合条件的记录存在',
										minColToggle : 1, //允许显示的最小列数
										showTableToggleBtn : true,
										autoload : true, //自动加载，即第一次发起ajax请求
										resizable : false, //table是否可伸缩
										procmsg : '加载中, 请稍等 ...',
										hideOnSubmit : true, //是否在回调时显示遮盖
										blockOpacity : 0.5,//透明度设置
										showcheckbox : true,//是否显示第一列的checkbox（用于全选）
										gridClass : "bbit-grid",//样式
										rowhandler : contextmenu,//是否启用行的扩展事情功能,在生成行时绑定事件，如双击，右键等
										rowbinddata : true,//配合上一个操作，如在双击事件中获取该行的数据
										onrowchecked : callme
									//在每一行的的checkbox选中状态发生变化时触发某个事件
									//onrowchecked: false//在每一行的的checkbox选中状态发生变化时触发某个事件
});

					//alert('ssssss');
					function callme() {
						//alert("aaaaaaaaa");
					}
					function contextmenu(row) {
						var menu = {
							width : 150,
							items : [
									{
										text : "选择",
										icon : "/dss.report.virtual/images/icons/search.png",
										alias : "contextmenu-select",
										action : contextMenuItem
									},
									{
										text : "查看",
										icon : "/dss.report.virtual/images/icons/search.png",
										alias : "contextmenu-view",
										action : contextMenuItem
									},
									{
										text : "编辑",
										icon : "/dss.report.virtual/images/icons/modify.png",
										alias : "contextmenu-modify",
										action : contextMenuItem
									},
									{
										text : "删除",
										icon : "/dss.report.virtual/images/icons/close.png",
										alias : "contextmenu-delete",
										action : contextMenuItem
									} ]
						};
						function contextMenuItem(target) {
							var id = $(target).attr("id").substr(3);
							var cmd = this.data.alias;
							var ch = $.browser.msie ? target.ch : target
									.getAttribute("id");
							var cell = ch.split("_FG$SP_");

							//alert(ch);
							//alert(cmd[1]);
							
							if (cmd == "contextmenu-select") {

								if (confirm("您确认选择 [" + id + "]  工作区吗？")) {
									$('#workspace_setWorkspace').dialog({closed:true});

									$.getJSON("/dss.report.virtual/workspaceController?action=getNameById&id="+id, function(json){
										  //alert("JSON Data: " + );
										  var name = json.WORKSPACENAME;
										  var desc = json.WORKSPACEDESC;
										//  $(").appendTo();
										  $("datasource_msg_default").hide();
										  //$("#datasource_msg_content1").attr("id",json.ID);
										  $("#datasource_msg_content1").attr('workspaceid',id)
										  .attr('WORKSPACENAME',name)
										  .attr('WORKSPACEDESC',desc)
										  .html("<span style='background:lightgreen;'>您已经选择了 ["+id+"  " + name + "]  工作区**** "+desc+" </span>");
									});
									 
								}
								
								//alert("select，产品编号=" + id);

							} else if (cmd == "contextmenu-view") {

								alert("编辑，产品编号=" + id);
								
							} else if (cmd == "contextmenu-modify") {
								
								alert("编辑，产品编号=" + id);
								
							} else if (cmd == "contextmenu-delete") {
								
								var name = cell[1];

								if (confirm("你确认要删除商品 [" + name + "] 吗？")) {
									alert("删除，产品编号=" + id);
								}
								cell[1] = "ssssssssssssssssssssssssss";
								$("#flex1").flexReload();
							} else {
								$("#flex1").flexReload();
							}
						}
						$(row).contextmenu(menu);
					}

					function toolbarItem(com, grid) {
						if (com == 'delete') {
							if ($('.trSelected', grid).length == 0) {
								alert("请选择要删除的数据");
							} else {
								if (confirm('是否删除这 ' + $('.trSelected', grid).length + ' 条记录吗?')) {
									var ids = "";
									for ( var i = 0; i < $('.trSelected', grid).length; i++) {
										ids += ","
												+ $('.trSelected', grid).find(
														"td:eq(2)").eq(i)
														.text();//获取id,td:eq(2)
									}
									ids = ids.substring(1);
									$
											.ajax( {
												type : "POST",
												url : "flexGridServlet.do?action=delete",
												data : "id=" + ids,
												dataType : "text",
												success : function(msg) {
													if (msg == "success") {
														$("#flex1")
																.flexReload();
													} else {
														alert("有错误发生,msg="
																+ msg);
													}
												},
												error : function(msg) {
													alert("msg=" + msg);
												}
											});
								}
							}
						} else if (com == 'add') {
							//alert("flexGridServlet.do?action=add");
							//window.location.href="flexGridServlet.do?action=add";

							$('#workspace_addWorkspace')
									.dialog(
											{
												//modal: true,
												closed : false,
												height : winHeight - 150,
												width : 700,
												left : 50,
												top : 30,
												href : '/dss.report.virtual/jsp/virtual/workspace/workspace/add.jsp'
											});

						} else if (com == 'modify') {
							if ($(".trSelected").length == 1) {
								window.location.href = "flexGridServlet.do?action=modify&id="
										+ $('.trSelected', grid).find("td").eq(
												2).text();
							} else if ($(".trSelected").length > 1) {
								alert("请选择一个修改,不能同时修改多个");
							} else if ($(".trSelected").length == 0) {
								alert("请选择一个您要修改的记录")
							}
							//$("#flex1").flexReload({});
						}
					}
					function formatMoney(value, pid) {
						//return "￥" + parseFloat(value).toFixed(2);
					}

				});
</script>
<style>
   
   .bbit-grid div.fbutton .add{
       	padding-left:20px;
        background: url(images/icons/add.png) no-repeat center left;
   }
   .bbit-grid div.fbutton .modify{
       padding-left:20px;
       background: url(images/icons/modify.png) no-repeat center left;
   }
   .bbit-grid div.fbutton .delete{
       padding-left:20px;
       background: url(images/icons/close.png) no-repeat center left;
   }
    
</style>
</head>
<body>
<fieldset>

<form action="queryController?action=customQuery">
width : w,
								
										colModel : [ {
											display : '编号',
											name : 'id',
											width : 50,
											sortable : true,
											align : 'center',
											toggle : false
										}, {
											display : 'table id',
											name : 'table_id',
											width : 250,
											sortable : true,
											align : 'center'
										}, {
											display : '描述',
											name : 'workSpaceDesc',
											width : 120,
											sortable : true,
											align : 'right'
										}, {
											display : '创建人',
											name : 'creator',
											width : 60,
											sortable : true,
											align : 'center'
										}, {
											display : '创建日期',
											name : 'createdDate',
											width : 80,
											sortable : true,
											align : 'center'
										} ],
										
										searchitems : [ {
											display : '编号',
											name : 'id',
											isdefault : true
										}, {
											display : '工作名称',
											name : 'job_name'
										}, {
											display : '工作地址',
											name : 'work_address'
										}, {
											display : '语言',
											name : 'language'
										} ],
										errormsg : '发生异常',
										sortname : "id",
										querySql : $("#queryFormSql").val(),
										sortorder : "desc",
										//qop: "LIKE",//搜索的操作符
										usepager : true,
										title : '测试信息明细',
										pagestat : '显示记录从{from}到{to}，总数 {total} 条',
										useRp : true,
										rp : 10,
										rpOptions : [ 10, 15, 20, 30, 40, 100 ], //可选择设定的每页结果数
										nomsg : '没有符合条件的记录存在',
										minColToggle : 1, //允许显示的最小列数
										showTableToggleBtn : true,
										autoload : true, //自动加载，即第一次发起ajax请求
										resizable : false, //table是否可伸缩
										procmsg : '加载中, 请稍等 ...',
										hideOnSubmit : true, //是否在回调时显示遮盖
										blockOpacity : 0.5,//透明度设置
										showcheckbox : true,//是否显示第一列的checkbox（用于全选）
										gridClass : "bbit-grid",//样式
										rowhandler : contextmenu,//是否启用行的扩展事情功能,在生成行时绑定事件，如双击，右键等
										rowbinddata : true,//配合上一个操作，如在双击事件中获取该行的数据
										onrowchecked : callme
	
	width<input type="text" name='width'>
	height:<input type="text" name='height'>
										url :<input type="text" name='height'> '/nmdss/queryController?action=list',
										dataType : 'json',
										colModel : [ {
											display : '编号',
											name : 'id',
											width : 50,
											sortable : true,
											align : 'center',
											toggle : false
										},
	开始日期<input type="text" name=''>
	结束日期<input type="text" name=''>
	
	<input type="text" id="queryFormSql" value="(select id,table_id from nmdss_dss_table_attr)">
	<input type="button" value="query" onclick="myclick();"> 
	</form>
</fieldset>

<div id="ptable" style="margin:10px">
	<table id="flex1" style="display:none"></table>
</div>  
<input id="action" type="hidden" name="action" value="null" />
<input id="method" type="hidden" name="method" value="null" />
<script>
   		function myclick(){
   	   		alert('myclick');
   	   	 	window.location.reload();
   			$("#flex1").flexReload({query:'where id=3566'});
   	   	}
</script>

</body>
</html>